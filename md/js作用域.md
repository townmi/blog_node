title: JS作用域
date: 2014-05-20 22:18:04
tags: 作用域
categories: javascript
---
### 作用域是JS里面的一个难点 ###
----------
一般情况下，我们在写代码的同时，并不会太关心作用域的问题，往往只有程序出错的时候，我们才会考虑是不是作用域的问题。当然作用域的定义，咱们可以自己百度，网上一大堆解释。

1.  首先我们得先知道什么东西它有作用域，---变量，肯定的。不管是简单的数字、Bollen或者字符串，还是object或者函数。他们都有作用域.
2.  然后我们得知道这个鬼作用域在什么时候出现，或者说，什么情况下会有作用域。javascript中只有当遇到函数的时候，作用域才随之会出现。《权威指南》中在变量作用域这一章节有说明。当然许多前辈都提到function是javascript的一等公民。也许原因就在这儿。

当然就知道上面两点，我们还不能完全搞懂JS的作用域。前提是我们还得先了解JS的运作机理，就是JS是怎么工作的：

1.  首先 -- 预编译，什么是预编译。预编译就是JS会将`var`定义的变量**名称**和`function`**整体**以及函数的`arguments`**名称**提前保存起来，也就是《权威指南》中提到的声明提前。JS预编译，只会去获取**名称**和**函数整体**，不会进行操作。
<!-- more -->

```
	<script type="text/javascript">
		alert(b);
		alert(a);
		var b = 1;
		a = 1;
	</script>
```
我们会发现第一次弹出undefined，第二次会报错。说明变量`b`被预编译了，`a`却没有。所以只有`var`过的变量才会被JS与解析。
```
	<script type="text/javascript">
		alert(b);
		function b(){
			b = 4;
		}
		var b = 3;
	</script>
```
我们会发现这次弹出的不是undefined了，而是把整个函数弹出来了，仔细看，发现变量名称与函数名称重名了。在JS的预编译过程中，如果发生变量名称与函数名称重名，那么`function`**整体**会覆盖`var`定义的变量**名称**；当然如果有两个函数都是`function b(){}`的话，那么执行程序的通用规则--后者覆盖前者。
```
	<script type="text/javascript">
		function a(b){
			alert(b);
			alert(c);
			c = 1;
		}
		a();
	</script>
```
在函数内部，参数也会被预编译。其实上面的函数可以看成`function a( var b ){···}`，仔细发现作用域悄然而生，函数的参数只会在函数内部有效的原因就在于`var`。

2.  JS预编译完了之后就是语句的逐行执行。这就和其他语言没什么区别了。

当我们理解了javascript的工作原理之后，作用域也就不是难事了。